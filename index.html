<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white text-gray-800 font-sans">

  <!-- üîπ Navbar -->
  <div class="bg-blue-600 text-white p-4 flex justify-between items-center">
    <h1 class="text-xl font-bold">‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</h1>
    <div>
      <button onclick="showSection('dashboard')" class="px-4 py-2 bg-white text-blue-600 rounded hover:bg-blue-100">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
      <button onclick="showSection('register')" class="px-4 py-2 bg-white text-blue-600 rounded hover:bg-blue-100 ml-2">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
    </div>
  </div>

  <!-- üîπ Section: Dashboard -->
  <div id="dashboard" class="p-6">
    <h2 class="text-lg font-semibold mb-2">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</h2>
    <input type="text" id="searchInput" oninput="loadData()" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠/‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" class="p-2 border rounded mb-4 w-full max-w-md" />
    <p class="mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="totalCount">0</span></p>
    <div class="overflow-x-auto">
      <table class="min-w-full border text-sm">
        <thead class="bg-blue-100">
          <tr>
            <th class="border p-1">‡∏£‡∏´‡∏±‡∏™</th>
            <th class="border p-1">‡∏ä‡∏∑‡πà‡∏≠</th>
            <th class="border p-1">‡∏™‡∏Å‡∏∏‡∏•</th>
            <th class="border p-1">‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏à‡∏ö</th>
            <th class="border p-1">‡πÄ‡∏Å‡∏£‡∏î‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</th>
          </tr>
        </thead>
        <tbody id="alumniTableBody"></tbody>
      </table>
    </div>
  </div>

  <!-- üîπ Section: Register -->
  <div id="register" class="hidden p-6">
    <h2 class="text-lg font-semibold mb-2">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</h2>
    <form id="alumniForm" class="space-y-4">
      <input type="text" name="id" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="block w-full border p-2 rounded" required>
      <input type="text" name="fname" placeholder="‡∏ä‡∏∑‡πà‡∏≠" class="block w-full border p-2 rounded" required>
      <input type="text" name="lname" placeholder="‡∏™‡∏Å‡∏∏‡∏•" class="block w-full border p-2 rounded" required>
      <input type="tel" name="phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" class="block w-full border p-2 rounded" required>
      <input type="number" name="grad" placeholder="‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏û.‡∏®.)" class="block w-full border p-2 rounded" required>
      <input type="number" name="gpa" step="0.01" placeholder="‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢" class="block w-full border p-2 rounded" required>
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </form>
  </div>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxZu8RMujbjmDcARWLpbZEcvj99oU77ss9xVckIYMOAMVBesHGK6cpJVjook-L90x8K/exec';

    function showSection(sectionId) {
      document.getElementById('dashboard').classList.add('hidden');
      document.getElementById('register').classList.add('hidden');
      document.getElementById(sectionId).classList.remove('hidden');
      if (sectionId === 'dashboard') loadData();
    }

    // üì• ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    document.getElementById('alumniForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const data = new FormData(form);

      const response = await fetch(scriptURL, {
        method: 'POST',
        body: data
      });

      if (response.ok) {
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
        form.reset();
        showSection('dashboard');
      } else {
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å");
      }
    });

    // üìä ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
    async function loadData() {
      const res = await fetch(scriptURL + '?read=1');
      const data = await res.json();
      const rows = data.slice(1); // ‡∏ï‡∏±‡∏î header ‡∏≠‡∏≠‡∏Å

      const body = document.getElementById('alumniTableBody');
      const search = document.getElementById('searchInput').value.toLowerCase();
      body.innerHTML = '';
      let count = 0;

      rows.forEach(row => {
        const [id, fname, lname, phone, grad, gpa] = row;
        const keyword = `${fname} ${lname}`.toLowerCase();
        if (!search || keyword.includes(search)) {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class="border p-1">${id}</td>
            <td class="border p-1">${fname}</td>
            <td class="border p-1">${lname}</td>
            <td class="border p-1">${grad}</td>
            <td class="border p-1">${gpa}</td>
          `;
          body.appendChild(tr);
          count++;
        }
      });

      document.getElementById('totalCount').textContent = count;
    }

    // ‡πÇ‡∏´‡∏•‡∏î dashboard ‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
    window.onload = () => showSection('dashboard');
  </script>
</body>
</html>
