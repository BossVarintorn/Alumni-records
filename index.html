<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white text-gray-800 font-sans">

  <!-- üîπ Navbar -->
<!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤ (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏Ç‡∏≠‡∏á body) -->
<div class="flex gap-2 bg-blue-100 p-2">
  <button onclick="showSection('dashboard')" class="bg-white px-4 py-2 rounded">Dashboard</button>
  <button onclick="showSection('register')" class="bg-white px-4 py-2 rounded">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
</div>


<!-- Dashboard Section -->
<div id="dashboard" class="hidden p-4 max-w-5xl mx-auto">
  <h2 class="text-2xl font-bold text-center text-blue-800 mb-6">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</h2>
  
  <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ß‡∏° -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-center mt-4">
      <div class="bg-blue-100 p-4 rounded-xl shadow-md">
        <h2 class="text-lg font-semibold text-blue-800">‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
        <p id="totalCount" class="text-2xl font-bold text-blue-900">0</p>
      </div>
      <div class="bg-blue-100 p-4 rounded-xl shadow-md">
        <h2 class="text-lg font-semibold text-blue-800">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ä‡∏≤‡∏¢</h2>
        <p id="maleCount" class="text-2xl font-bold text-blue-900">0</p>
      </div>
      <div class="bg-blue-100 p-4 rounded-xl shadow-md">
        <h2 class="text-lg font-semibold text-blue-800">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏´‡∏ç‡∏¥‡∏á</h2>
        <p id="femaleCount" class="text-2xl font-bold text-blue-900">0</p>
      </div>
      <div class="bg-blue-100 p-4 rounded-xl shadow-md">
        <h2 class="text-lg font-semibold text-blue-800">‡∏õ‡∏µ‡∏à‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
        <p id="latestGradYear" class="text-2xl font-bold text-blue-900">-</p>
      </div>
    </div>


  <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -->
  <input type="text" id="searchInput" oninput="loadData()" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏™‡∏Å‡∏∏‡∏•..." class="border border-gray-300 rounded w-full p-2 mb-4">

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á -->
  <div class="overflow-auto">
    <table class="w-full border-collapse border border-gray-300 text-sm">
      <thead class="bg-blue-200">
        <tr>
          <th class="border p-2">‡∏£‡∏´‡∏±‡∏™</th>
          <th class="border p-2">‡∏ä‡∏∑‡πà‡∏≠</th>
          <th class="border p-2">‡∏™‡∏Å‡∏∏‡∏•</th>
          <th class="border p-2">‡πÄ‡∏û‡∏®</th>
          <th class="border p-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</th>
          <th class="border p-2">‡∏õ‡∏µ‡∏à‡∏ö</th>
          <th class="border p-2">GPA</th>
        </tr>
      </thead>
      <tbody id="alumniTableBody">
        <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
      </tbody>
    </table>
  </div>
</div>


  <!-- üîπ Section: Register -->
<div id="register" class="hidden p-4">
  <h2 class="text-xl font-bold mb-2">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</h2>
  <form id="alumniForm" class="grid grid-cols-1 gap-2">
    <input type="text" name="studentId" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" required class="border p-2 rounded">
    <input type="text" name="firstName" placeholder="‡∏ä‡∏∑‡πà‡∏≠" required class="border p-2 rounded">
    <input type="text" name="lastName" placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required class="border p-2 rounded">
    <select name="gender" required class="border p-2 rounded">
      <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏®</option>
      <option value="‡∏ä‡∏≤‡∏¢">‡∏ä‡∏≤‡∏¢</option>
      <option value="‡∏´‡∏ç‡∏¥‡∏á">‡∏´‡∏ç‡∏¥‡∏á</option>
    </select>
    <input type="tel" name="phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" required class="border p-2 rounded">
    <input type="number" name="gradYear" placeholder="‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏à‡∏ö (‡∏û.‡∏®.)" required class="border p-2 rounded">
    <input type="number" step="0.01" name="gpa" placeholder="‡πÄ‡∏Å‡∏£‡∏î‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢" required class="border p-2 rounded">
    <button type="submit" class="bg-blue-500 text-white p-2 rounded">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  </form>
</div>


  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxZu8RMujbjmDcARWLpbZEcvj99oU77ss9xVckIYMOAMVBesHGK6cpJVjook-L90x8K/exec';

  function showSection(id) {
    document.getElementById('dashboard').classList.add('hidden');
    document.getElementById('register').classList.add('hidden');
    document.getElementById(id).classList.remove('hidden');
  }


    // üì• ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    document.getElementById('alumniForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const data = new FormData(form);

      const response = await fetch(scriptURL, {
        method: 'POST',
        body: data
      });

      if (response.ok) {
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
        form.reset();
        showSection('dashboard');
      } else {
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å");
      }
    });

    // üìä ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
async function loadData() {
  const res = await fetch(scriptURL + '?read=1');
  const data = await res.json();
  const rows = data.slice(1); // ‡∏•‡∏∞ header ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å

  const body = document.getElementById('alumniTableBody');
  const search = document.getElementById('searchInput').value.toLowerCase();
  body.innerHTML = '';

  // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
  let total = 0;
  let maleCount = 0;
  let femaleCount = 0;
  let currentGradYear = 0;

  rows.forEach(row => {
    const [id, fname, lname, gender, phone, grad, gpa] = row;
    const keyword = `${fname} ${lname}`.toLowerCase();

    if (!search || keyword.includes(search)) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="border p-1">${id}</td>
        <td class="border p-1">${fname}</td>
        <td class="border p-1">${lname}</td>
        <td class="border p-1">${gender}</td>
        <td class="border p-1">${phone}</td>
        <td class="border p-1">${grad}</td>
        <td class="border p-1">${gpa}</td>
      `;
      body.appendChild(tr);
      total++;
    }

    // ‡∏ô‡∏±‡∏ö‡πÄ‡∏û‡∏®
    if (gender === '‡∏ä‡∏≤‡∏¢') maleCount++;
    else if (gender === '‡∏´‡∏ç‡∏¥‡∏á') femaleCount++;

    // ‡∏õ‡∏µ‡∏à‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
    if (parseInt(grad) > currentGradYear) {
      currentGradYear = parseInt(grad);
    }
  });

  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
  document.getElementById('totalCount').textContent = total;
  document.getElementById('maleCount').textContent = maleCount;
  document.getElementById('femaleCount').textContent = femaleCount;
  document.getElementById('latestGradYear').textContent = currentGradYear || "-";
}

// ‡πÇ‡∏´‡∏•‡∏î dashboard ‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
window.onload = () => {
  showSection('dashboard');
  loadData();
};


  </script>
</body>
</html>
