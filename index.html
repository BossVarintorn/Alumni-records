<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white text-gray-800 font-sans">

  <!-- üîπ Navbar -->
<!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤ (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏Ç‡∏≠‡∏á body) -->
<div class="flex justify-center bg-blue-100 p-4 space-x-4">
  <button onclick="showSection('form')" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
  <button onclick="showSection('dashboard')" class="bg-white border border-blue-500 text-blue-500 px-4 py-2 rounded hover:bg-blue-100">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
</div>

<!-- Dashboard Section -->
<div id="dashboard" class="hidden p-4 max-w-5xl mx-auto">
  <h2 class="text-2xl font-bold text-center text-blue-800 mb-6">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</h2>
  
  <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ß‡∏° -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-center mt-4">
      <div class="bg-blue-100 p-4 rounded-xl shadow-md">
        <h2 class="text-lg font-semibold text-blue-800">‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
        <p id="totalCount" class="text-2xl font-bold text-blue-900">0</p>
      </div>
      <div class="bg-blue-100 p-4 rounded-xl shadow-md">
        <h2 class="text-lg font-semibold text-blue-800">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ä‡∏≤‡∏¢</h2>
        <p id="maleCount" class="text-2xl font-bold text-blue-900">0</p>
      </div>
      <div class="bg-blue-100 p-4 rounded-xl shadow-md">
        <h2 class="text-lg font-semibold text-blue-800">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏´‡∏ç‡∏¥‡∏á</h2>
        <p id="femaleCount" class="text-2xl font-bold text-blue-900">0</p>
      </div>
      <div class="bg-blue-100 p-4 rounded-xl shadow-md">
        <h2 class="text-lg font-semibold text-blue-800">‡∏õ‡∏µ‡∏à‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
        <p id="latestGradYear" class="text-2xl font-bold text-blue-900">-</p>
      </div>
    </div>


  <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -->
  <input type="text" id="searchInput" oninput="loadData()" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏™‡∏Å‡∏∏‡∏•..." class="border border-gray-300 rounded w-full p-2 mb-4">

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á -->
  <div class="overflow-auto">
    <table class="w-full border-collapse border border-gray-300 text-sm">
      <thead class="bg-blue-200">
        <tr>
          <th class="border p-2">‡∏£‡∏´‡∏±‡∏™</th>
          <th class="border p-2">‡∏ä‡∏∑‡πà‡∏≠</th>
          <th class="border p-2">‡∏™‡∏Å‡∏∏‡∏•</th>
          <th class="border p-2">‡πÄ‡∏û‡∏®</th>
          <th class="border p-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</th>
          <th class="border p-2">‡∏õ‡∏µ‡∏à‡∏ö</th>
          <th class="border p-2">GPA</th>
        </tr>
      </thead>
      <tbody id="alumniTableBody">
        <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
      </tbody>
    </table>
  </div>
</div>


  <!-- üîπ Section: Register -->
  <div id="register" class="hidden p-6">
    <h2 class="text-lg font-semibold mb-2">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</h2>
    <form id="alumniForm" class="space-y-4">
      <input type="text" name="id" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="block w-full border p-2 rounded" required>
      <input type="text" name="fname" placeholder="‡∏ä‡∏∑‡πà‡∏≠" class="block w-full border p-2 rounded" required>
      <input type="text" name="lname" placeholder="‡∏™‡∏Å‡∏∏‡∏•" class="block w-full border p-2 rounded" required>
      <!-- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏° -->
        <label class="block text-gray-700">‡πÄ‡∏û‡∏®:</label>
        <select name="gender" class="border rounded w-full p-2 mb-4" required>
          <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏® --</option>
          <option value="‡∏ä‡∏≤‡∏¢">‡∏ä‡∏≤‡∏¢</option>
          <option value="‡∏´‡∏ç‡∏¥‡∏á">‡∏´‡∏ç‡∏¥‡∏á</option>
        </select>

      <input type="tel" name="phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" class="block w-full border p-2 rounded" required>
      <input type="number" name="grad" placeholder="‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏û.‡∏®.)" class="block w-full border p-2 rounded" required>
      <input type="number" name="gpa" step="0.01" placeholder="‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢" class="block w-full border p-2 rounded" required>
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </form>
  </div>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxZu8RMujbjmDcARWLpbZEcvj99oU77ss9xVckIYMOAMVBesHGK6cpJVjook-L90x8K/exec';

    function showSection(sectionId) {
      document.getElementById('dashboard').classList.add('hidden');
      document.getElementById('register').classList.add('hidden');
      document.getElementById(sectionId).classList.remove('hidden');
      if (sectionId === 'dashboard') loadData();
    }

    // üì• ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    document.getElementById('alumniForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const data = new FormData(form);

      const response = await fetch(scriptURL, {
        method: 'POST',
        body: data
      });

      if (response.ok) {
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
        form.reset();
        showSection('dashboard');
      } else {
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å");
      }
    });

    // üìä ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
async function loadData() {
  const res = await fetch(scriptURL + '?read=1');
  const data = await res.json();
  const rows = data.slice(1); // ‡∏ï‡∏±‡∏î header

  const body = document.getElementById('alumniTableBody');
  const search = document.getElementById('searchInput').value.toLowerCase();
  body.innerHTML = '';

  // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
  let total = 0;
  let male = 0;
  let female = 0;
  let latestYear = 0;

  rows.forEach(row => {
    rows.forEach(row => {
    const [id, fname, lname, gender, phone, grad, gpa] = row;
    const keyword = `${fname} ${lname}`.toLowerCase();
    if (!search || keyword.includes(search)) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="border p-1">${id}</td>
        <td class="border p-1">${fname}</td>
        <td class="border p-1">${lname}</td>
        <td class="border p-1">${gender}</td>
        <td class="border p-1">${phone}</td>
        <td class="border p-1">${grad}</td>
        <td class="border p-1">${gpa}</td>
      `;
      body.appendChild(tr);
      total++;

      // ‡∏ô‡∏±‡∏ö‡πÄ‡∏û‡∏®
          let maleCount = 0;
          let femaleCount = 0;
          let currentGradYear = 0;
          
          rows.forEach(row => {
            const [id, fname, lname, gender, phone, grad, gpa] = row;
            if (gender === '‡∏ä‡∏≤‡∏¢') maleCount++;
            else if (gender === '‡∏´‡∏ç‡∏¥‡∏á') femaleCount++;
          
            if (parseInt(grad) > currentGradYear) {
              currentGradYear = parseInt(grad);
            }
          });

  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
      document.getElementById('totalCount').textContent = rows.length;
      document.getElementById('maleCount').textContent = maleCount;
      document.getElementById('femaleCount').textContent = femaleCount;
      document.getElementById('latestGradYear').textContent = currentGradYear;
}


    // ‡πÇ‡∏´‡∏•‡∏î dashboard ‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
    window.onload = () => showSection('dashboard');
  </script>
</body>
</html>
